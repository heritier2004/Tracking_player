<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ferwafa Dashboard</title>
  <link rel="stylesheet" href="../shared/css/global.css" />
  <style>
    body{font-family:Segoe UI, Roboto, Arial;margin:18px;background:#f7fafc}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between}
    .card{background:#fff;padding:14px;border-radius:8px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #eee}
    .filters{display:flex;gap:8px;margin:12px 0}
    .btn{padding:8px 10px;border-radius:6px;border:0;cursor:pointer;background:#0b5cff;color:#fff}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Ferwafa â€” Players Overview</h1>
      <div>
        <a href="/" class="btn">Home</a>
      </div>
    </header>

    <div style="margin-top:12px" class="card">
      <div class="filters">
        <input id="filterSchool" placeholder="School" />
        <input id="filterAcademy" placeholder="Academy" />
        <input id="minGoals" type="number" placeholder="Min goals" style="width:120px" />
        <button id="applyBtn" class="btn">Apply</button>
        <button id="clearBtn" class="btn" style="background:#6b7280">Clear</button>
      </div>

      <table id="playersTable">
        <thead>
          <tr><th>Rank</th><th>Name</th><th>Team</th><th>School</th><th>Academy</th><th>Goals</th><th>Minutes</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const API_TOP = '/api/players/top';
    const $ = id => document.getElementById(id);

    async function loadTop(){
      const school = (($('filterSchool').value||'').trim());
      const academy = (($('filterAcademy').value||'').trim());
      const min_goals = (($('minGoals').value||'').trim());
      const qs = new URLSearchParams();
      if(school) qs.set('school', school);
      if(academy) qs.set('academy', academy);
      if(min_goals) qs.set('min_goals', min_goals);
      qs.set('limit', '100');
      try{
        const res = await fetch(API_TOP + '?' + qs.toString(), {credentials:'include'});
        if(!res.ok) throw new Error(res.statusText);
        const players = await res.json();
        render(players);
      }catch(e){ alert('Failed to load players: '+e.message); }
    }

    function render(players){
      const tbody = document.querySelector('#playersTable tbody');
      tbody.innerHTML = '';
      players.forEach((p,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i+1}</td><td>${escapeHtml(p.name)}</td><td>${escapeHtml(p.team||'')}</td><td>${escapeHtml(p.school||'')}</td><td>${escapeHtml(p.academy||'')}</td><td>${p.stats?.goals||0}</td><td>${p.stats?.minutes||0}</td>`;
        tbody.appendChild(tr);
      });
    }

    function escapeHtml(s){return String(s||'').replace(/[&<>\"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));}

    document.addEventListener('DOMContentLoaded', ()=>{
      $('applyBtn').addEventListener('click', loadTop);
      $('clearBtn').addEventListener('click', ()=>{ $('filterSchool').value=''; $('filterAcademy').value=''; $('minGoals').value=''; loadTop(); });
      loadTop();
    });
  </script>
</body>
</html>
